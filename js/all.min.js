window.app=window.app||{},function(){"use strict";var n=window.app,e=n.DEFECT=window.app.DEFECT||1,t=n.COOPERATE=window.app.COOPERATE||0;n.AllC=function(){return t},n.AllD=function(){return e},n.Rand=function(){return Math.random()>.5?t:e},n.Grim=function(n){return n.some(function(n){return n.move===e})?e:t},n.Neg=function(n){var r=n.slice(-1)[0];return r&&r.move===t?e:t},n.TFT=function(n){var e=n.slice(-1)[0];return e?e.move:t},n.STFT=function(n){var t=n.slice(-1)[0];return t?t.move:e},n.TFTT=function(n){return n.length>1&&n[n.length-1].move===e&&n[n.length-2].move===e?e:t},n.Pavlov=function(n,r){if(r.length){var o=r.slice(-1)[0];return o.success?o.move:o.move===e?t:e}return Math.random()>.5?t:e},n.CD=function(n,r){if(r.length){var o=r.slice(-1)[0];return o.move===e?t:e}return t},n.SoftMajo=function(n){var r=n.filter(function(n){return n.move===t}).length;return 2*r>=n.length?t:e},n.strategies=[{f:n.AllC,name:"AllC"},{f:n.AllD,name:"AllD"},{f:n.Rand,name:"Rand"},{f:n.Grim,name:"Grim"},{f:n.Neg,name:"Neg"},{f:n.TFT,name:"TFT"},{f:n.STFT,name:"STFT"},{f:n.TFTT,name:"TFTT"},{f:n.Pavlov,name:"Pavlov"},{f:n.CD,name:"CD"},{f:n.SoftMajo,name:"SoftMajo"}]}(); window.app=window.app||{},window.app.Game=function(a,e,t,n,o,s,r){"use strict";window.app.DEFECT=1,window.app.COOPERATE=0;var i={a:0,b:0};this.play=function(){var a={a:[],b:[]},s=0;for(s=1;o>=s;s+=1){var u=t(a.b,a.a),f=n(a.a,a.b),p=this.getPayoff(a.a,u,f),c=this.getPayoff(a.b,f,u);a.a.push({move:u,result:p,success:e.indexOf(p)>-1}),a.b.push({move:f,result:c,success:e.indexOf(c)>-1}),i.a+=p,i.b+=c,r&&(console.log(t.name+": "+u+". total: "+i[0]),console.log(n.name+": "+f+". total: "+i[1]))}return this},this.getPayoff=function(e,t,n){var o=a[t][n],r=e.length;if(r<s.movesCountAnalyze)return o;var i,u=0;for(i=1;i<=s.movesCountAnalyze;i+=1){if(e[r-i].move===app.COOPERATE)return o;u+=e[r-i].result}return Math.random()>s.chance?-s.coeff*u:a[t][n]},this.getResults=function(){return[i.a,i.b,i.a+i.b]}}; var start=function(a,e){"use strict";var n=window.app,r=[[3,0],[5,1]],t=[r[0][0],r[0][1],r[1][0],r[1][1]].sort().slice(-2),o=2*r[0][0]*e,s={movesCountAnalyze:5,chance:.7,coeff:.2},u=function(o,u,c){var i,l=[0,0,0];for(i=0;a>i;i+=1)new n.Game(r,t,o,u,e,s,c).play().getResults().forEach(function(a,e){l[e]+=a});return l.map(function(e){return Math.round(e/a*100)/100})},c=function(a){var e,n,r,t,o=[];for(e=0,n=a.length;n>e;e+=1){var s=0,u=[];for(r=0,t=a[e].length;t>r;r+=1)s<a[e][r][1]?(s=a[e][r][1],u=[r]):s===a[e][r][1]&&u.push(r);u.forEach(function(r){var t,s=!0;for(t=0;n>t;t+=1)if(a[e][r][0]<a[t][r][0]){s=!1;break}s&&o.push({value:a[e][r],row:e+1,column:r+1})})}return o},i=function(a){var e,n=[a[0]];for(e=1;e<a.length;e+=1)n[0].value[2]<a[e].value[2]?n=[a[e]]:n[0].value[2]===a[e].value[2]&&n.push(a[e]);return n},l=function(a){var e,n,r=$(".charts li");for(e=0;e<a.length;e+=1){var t=[];for(n=0;n<a[e].length;n+=1){var s=a[e][n];t.push({name:s[4],a:s[0],b:s[1],sum:s[2]})}Morris.Bar({element:$("<div/>",{"class":"chart"}).appendTo(r.eq(e)),data:t,xkey:"name",ykeys:["a","b","sum"],ymax:o,hideHover:"always"})}},v=function(a,e){var n=$("<ol/>");a.forEach(function(a){var e=a.value;$("<li/>",{text:e[3]+" / "+e[4]+": "+e.slice(0,3).join(", ")}).appendTo(n)}),$(e).append(n)},f=[],h={};n.strategies.forEach(function(a){var e={},r=[],t=a.name;n.strategies.forEach(function(n){var o=n.name,s=u(a.f,n.f);e[o]="["+s.reduce(function(a,e){return a+", "+e})+"]",r.push(s.concat([t,o]))}),h[t]=e,f.push(r)}),l(f),console.table&&console.table(h);var p=c(f);v(p,".nash"),console.log(p);var m=i(p);v(m,".pareto"),console.log(m)};$(function(){start($("#gamesCount").val(),$("#roundsCount").val());var a=function(){$(".chart").remove(),$(".equilibrium li").remove()};$("#restart").click(function(){var e=$("#gamesCount").val()>>0,n=$("#roundsCount").val()>>0,r=$(this).parent();r.find(".status").remove(),Number.isInteger(e)&&Number.isInteger(n)&&e>0&&n>1?(a(),start(e,n),$("html, body").animate({scrollTop:$(".charts").offset().top},500),r.append('<div class="status success">Готово<div>')):r.append('<div class="status error">Некорректные данные<div>')})});
